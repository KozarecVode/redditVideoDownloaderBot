let get,downloadFile,extractRedditUrls,getUrlObject;_3b0‍.x([["onReady",()=>onReady],["onMessage",()=>onMessage]]);_3b0‍.w("lodash",[["get",["get"],function(v){get=v}]]);_3b0‍.w("./general",[["downloadFile",["downloadFile"],function(v){downloadFile=v}],["extractRedditUrls",["extractRedditUrls"],function(v){extractRedditUrls=v}],["getUrlObject",["getUrlObject"],function(v){getUrlObject=v}]]);


       const onReady = (client) => {
  console.log(`Successfully logged in as ${client.user.tag}!`);
};

       const onMessage = async (msg) => {
  const discriminator = get(msg, "author.discriminator", null);

  if (discriminator && discriminator != process.env.BOT_DISCRIMINATOR) {
    const messageContent = get(msg, "content", "");
    const redditUrls = extractRedditUrls(messageContent);
    const firstUrl = redditUrls[0] ? redditUrls[0] : null;

    // Only use first reddit url
    // TODO: Add support for multiple urls in the same message?
    if (firstUrl) {
      getUrlObject(firstUrl)
        .then((urlObject) => {
          if (urlObject) {
            const permalink = get(urlObject, "permaLink", null);
            const videoUrl = get(urlObject, "videoUrl", null);
            const audioUrl = get(urlObject, "audioUrl", null);

            // Use https://ds.redditsave.com/ to download the actual mp4 file
            if (permalink && videoUrl && audioUrl) {
              const downloadUrl = `https://ds.redditsave.com/download-sd.php?permalink=${permalink}&video_url=${videoUrl}&audio_url=${audioUrl}`;
              downloadFile(downloadUrl);
            }
          }
        })
        .catch((e) => {
          _3b0‍.g.console.warn(e);
        });

      /*
      https://ds.redditsave.com/download-sd.php
      ?permalink=https://reddit.com/r/WTF/comments/nxy86w/jesus_take_the_wheel/
      &video_url=https://v.redd.it/ysa2lu6nfr471/DASH_360.mp4
      &audio_url=https://v.redd.it/ysa2lu6nfr471/DASH_audio.mp4
      */
    }
  }
};
